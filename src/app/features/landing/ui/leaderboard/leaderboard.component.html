<div class="leaderboard-header">
    <h2 class="leaderboard__title">Global Top 10</h2>

    <div class="leaderboard-header__options">
        <div>
            @if (isQuickDatesVisible()) {
                <app-leaderboard-quick-dates
                    class="leaderboard-header__quick-dates"
                    [timeframe]="(timeframe$ | async)!"
                    (selected)="onQuickDateSelected($event)" />
                <app-leaderboard-quick-dates-select
                    [timeframe]="(timeframe$ | async)!"
                    class="leaderboard-header__quick-dates-select"
                    (changed)="onQuickDateSelected($event)" />
            } @else {
                <span>{{ datepickerButtonText$ | async }}</span>
            }
        </div>
        <app-datepicker
            class="leaderboard-header__datepicker"
            [text]="(datepickerButtonText$ | async) || ''"
            [date]="tempDate$ | async"
            [selectedTimeframe]="(tempTimeframe$ | async)!"
            [timeframes]="datepickerTimeframes()"
            (dateChange)="onDateChange($event)"
            (timeframeChange)="onTimeframeChange($event)"
            (confirm)="onConfirm()" />
    </div>
</div>

@if (isSpinnerVisible$ | async) {
    <app-spinner class="leaderboard__spinner"></app-spinner>
}

@if (
    (isLoading$ | async) === false &&
    (isError$ | async) === false &&
    (topics$ | async) &&
    (timeframe$ | async)! !== "last24Hours"
) {
    <app-leaderboard-hint
        *ngIf="(timeframe$ | async) !== 'last24Hours' as timeframe"
        [selectedDate]="date$ | async"
        [selectedTimeframe]="(hintTimeframe$ | async)!"
        [timeframeStatus]="(timeframeStatus$ | async)!"
        (counterStopped)="updateTimeframeStatus()" />
}

@if (isContentVisible$ | async) {
    <ul class="leaderboard__list">
        @for (topicData of topics$ | async; track topicData.topic.id) {
            <li>
                <app-leaderboard-list-item
                    [topic]="topicData.topic"
                    [votes]="topicData.votes"
                    [users]="topicData.uniqueUsers"
                    [lastPulse]="(isActiveTimeframe$ | async) ? topicData.lastVoteTime : undefined"
                    [isActiveTimeframe]="(isActiveTimeframe$ | async) || false" />
            </li>
        }
    </ul>
}

@if (isEmpty$ | async) {
    <div class="info-message">No topics found for the selected time range.</div>
}

@if (isErrorVisible$ | async) {
    <div class="info-message">Error loading data. Please try again.</div>
}
