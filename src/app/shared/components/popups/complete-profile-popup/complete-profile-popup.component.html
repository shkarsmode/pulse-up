@let error = errorMessage();

<div class="popup">
    <app-close-button
        class="popup__close"
        (handleClick)="onCloseDialog()" />
    <h2>Set Up Your Public Profile to Start a Topic</h2>
    <p>
        To help build trust and credibility, your name and username will be visible on topics you
        create, but your support (pulses) always stays private.
    </p>

    <form
        [formGroup]="form"
        class="compllete-profile-form">
        <div class="compllete-profile-form__field">
            <app-input
                type="text"
                id="name"
                name="name"
                autocomplete="name"
                formControlName="name"
                label="Name"
                [hasErrorClass]="!!(form.get('name')?.touched && form.get('name')?.invalid)"
                (emitBlur)="onBlur('name')" />
            <div *ngIf="form.get('name')?.touched && getErrorMessage('name') as error">
                <span>{{ error }}</span>
            </div>
        </div>

        <div class="compllete-profile-form__field">
            <app-input
                autocomplete="off"
                type="text"
                id="username"
                name="username"
                formControlName="username"
                label="Username"
                [hasErrorClass]="!!(form.get('username')?.touched && form.get('username')?.invalid)"
                (emitBlur)="onBlur('username')" />
            <div *ngIf="form.get('username')?.touched && getErrorMessage('username') as error">
                <span>{{ error }}</span>
            </div>
        </div>
        @if (error) {
            <div class="compllete-profile-form__error">
                {{ error }}
            </div>
        }
        <div class="compllete-profile-form__submit">
            <app-primary-button
                type="submit"
                [fullWidth]="true"
                [disabled]="form.invalid || loading()"
                [loading]="loading()"
                (handleClick)="submit()">
                Save
            </app-primary-button>
        </div>
    </form>
</div>
